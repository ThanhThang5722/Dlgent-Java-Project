<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết đặt phòng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/CustomerView/Header.css}">
    <style>
        body {
            background-color: #f0f4f8;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .booking-detail-container {
            max-width: 1000px;
            margin: 30px auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            margin: 20px 0;
            color: #0d6efd;
            text-decoration: none;
            font-weight: 500;
        }

        .back-button i {
            margin-right: 5px;
        }

        .section {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .resort-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .booking-status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

        .status-upcoming {
            background-color: #e7f0f7;
            color: #0d6efd;
        }

        .status-completed {
            background-color: #e7f7ee;
            color: #28a745;
        }

        .status-cancelled {
            background-color: #f7e7e7;
            color: #dc3545;
        }

        .date-info {
            display: flex;
            justify-content: space-between;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .date-item {
            flex: 1;
            text-align: center;
        }

        .date-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .date-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .room-info {
            display: flex;
            margin-bottom: 15px;
        }

        .room-detail {
            flex: 1;
        }

        .room-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .room-specs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .room-spec {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #6c757d;
        }

        .room-spec i {
            margin-right: 5px;
            color: #0d6efd;
        }

        .service-list {
            margin-bottom: 20px;
        }

        .service-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .service-item i {
            color: #28a745;
            margin-right: 10px;
        }

        .cancellation-policy {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }

        .policy-header {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .policy-alert {
            border-left: 4px solid #dc3545;
            padding: 10px 15px;
            background-color: #f8f9fa;
            margin-bottom: 10px;
        }

        .policy-alert-title {
            color: #dc3545;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .policy-alert-text {
            font-size: 14px;
            color: #6c757d;
        }

        .policy-detail {
            font-size: 14px;
            color: #333;
        }

        .price-summary {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .price-label {
            color: #6c757d;
        }

        .price-value {
            font-weight: 500;
        }

        .total-price {
            font-size: 18px;
            font-weight: 600;
            color: #dc3545;
            border-top: 1px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }

        .cancel-button {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            font-weight: 500;
            margin-top: 20px;
            cursor: pointer;
        }

        .cancel-button:hover {
            background-color: #c82333;
        }

        .special-requests {
            margin-top: 20px;
        }

        .preferences-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .radio-group {
            margin-bottom: 20px;
        }

        .radio-group-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .radio-options {
            display: flex;
            gap: 50px;
        }

        .radio-option {
            display: flex;
            align-items: center;
        }

        .radio-circle {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 10px;
            position: relative;
        }

        .radio-label {
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .radio-icon {
            margin-right: 5px;
            color: #666;
        }

        .show-more {
            color: #3498db;
            font-size: 14px;
            font-weight: 500;
            margin-top: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .show-more-icon {
            margin-right: 8px;
            color: #3498db;
        }

        .upgrade-card {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }

        .upgrade-header {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .upgrade-icon {
            width: 32px;
            height: 32px;
            background-color: #ffdd57;
            border-radius: 50%;
        }

        .upgrade-title {
            font-weight: 600;
        }

        .included-tag {
            background-color: #27ae60;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .upgrade-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .free-badge {
            color: #27ae60;
            font-weight: 600;
            font-size: 16px;
        }

        .added-badge {
            color: #666;
            font-size: 14px;
            background-color: #f1f1f1;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .room-info {
            display: flex;
            gap: 15px;
        }

        .room-dates {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .date-box {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            flex: 1;
        }

        .date-box-day {
            font-weight: 600;
        }

        .date-box-time {
            font-size: 12px;
            color: #666;
        }

        .hotel-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }

        .hotel-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .hotel-rating {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .star-rating {
            color: #ff9500;
            margin-right: 5px;
        }

        .rating-score {
            color: #3498db;
            font-weight: 600;
            margin-right: 5px;
        }

        .rating-text {
            font-size: 14px;
            color: #3498db;
        }

        .rating-count {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
        }

        .hotel-location {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .hotel-amenities {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #e0e0e0;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .amenity-icon {
            width: 16px;
            height: 16px;
            margin-right: 5px;
            color: #27ae60;
        }

        .room-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .room-type {
            font-weight: 500;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .room-quantity {
            margin-right: 5px;
        }

        .room-size {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .room-occupancy {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .room-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .room-tag {
            background-color: #f1f1f1;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
        }

        .room-tag-icon {
            margin-right: 5px;
        }

        .next-button {
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .next-button:hover {
            background-color: #1669d9;
        }

        .button-hint {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .status-box {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .status-green {
            background-color: #e6f4ea;
            color: #137333;
        }

        .status-red {
            background-color: #fce8e6;
            color: #c5221f;
        }

        .status-orange {
            background-color: #fff8e1;
            color: #e37400;
        }

        .status-icon {
            margin-right: 10px;
        }

        .coupons-section {
            margin-top: 20px;
        }

        .coupon-title {
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .coupon-icon {
            margin-right: 8px;
            color: #27ae60;
        }

        .coupon-card {
            border: 1px solid #c8e6e4;
            border-radius: 8px;
            background-color: #f0f9f8;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .coupon-card:hover {
            border-color: #4db6ac;
            background-color: #e0f2f1;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .coupon-left {
            display: flex;
            align-items: center;
        }

        .coupon-logo {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .coupon-text {
            color: #00695c;
            font-weight: 500;
        }

        .coupon-amount {
            color: #00695c;
            font-weight: 600;
        }

        .coupon-gift {
            color: #00695c;
        }

        .price-breakdown {
            margin-top: 20px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .price-item-discount {
            color: #27ae60;
        }

        .price-item-free {
            color: #3498db;
        }

        .discount-badge {
            background-color: #e10700;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 14px;
        }

        .price-total {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 18px;
            font-weight: 600;
        }

        .price-info {
            display: flex;
            align-items: center;
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }

        .price-info-icon {
            margin-right: 5px;
        }

        .price-taxes {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .price-match {
            background-color: #27ae60;
            color: white;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 14px;
            border: 1px solid #1f9d55;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }

        .price-match:hover {
            background-color: #219653;
        }

        .price-match-info {
            margin-left: 5px;
            cursor: pointer;
        }

        .savings-text {
            color: #27ae60;
            font-weight: 600;
            font-size: 14px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .sign-in-btn {
            border: 1px solid #3498db;
            color: #3498db;
            background-color: white;
            border-radius: 50px;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .right-content {
                width: 100%;
                order: -1;
            }

            .form-row {
                flex-direction: column;
                gap: 10px;
            }

            .radio-options {
                flex-direction: column;
                gap: 10px;
            }

            .step-line {
                width: 50px;
            }
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            padding: 8px 0;
            border-bottom: 1px dashed #e0e0e0;
        }

        .price-row-discount {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            background-color: #e6f4ea;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #c3e6cb;
            transition: background-color 0.3s ease;
        }

        .price-row-discount:hover {
            background-color: #d4f0dc;
        }

        .price-row-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px solid #d4d4d4;
            padding-top: 15px;
            margin-top: 10px;
        }

        .price-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            transition: box-shadow 0.3s ease;
        }

        .price-card:hover {
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .price-card-header {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div th:replace="~{CustomerView/components/Header :: header}"></div>

    <div class="container">
        <a href="/user/booking-history" class="back-button">
            <i class="bi bi-arrow-left"></i> Quay lại lịch sử đặt phòng
        </a>

        <div class="booking-detail-container">
            <!-- Resort Image Section -->
            <div class="section">
                <img th:if="${booking != null && booking.hinhAnhUrl != null}" th:src="${booking.hinhAnhUrl}"
                    class="resort-image" alt="Resort Image">
                <img th:unless="${booking != null && booking.hinhAnhUrl != null}"
                    src="https://via.placeholder.com/800x400?text=Resort+Image" class="resort-image" alt="Resort Image">

                <div class="d-flex justify-content-between align-items-center">
                    <h2 th:if="${booking != null}" th:text="${booking.tenResort}">Tên Resort</h2>
                    <h2 th:unless="${booking != null}">Tên Resort</h2>

                    <div th:if="${booking != null}" class="booking-status-badge"
                        th:classappend="${booking.tinhTrang == 'upcoming' ? 'status-upcoming' : (booking.tinhTrang == 'completed' ? 'status-completed' : 'status-cancelled')}">
                        <span
                            th:text="${booking.tinhTrang == 'upcoming' ? 'Sắp tới' : (booking.tinhTrang == 'completed' ? 'Đã hoàn thành' : 'Đã hủy')}">Trạng
                            thái</span>
                    </div>
                </div>
            </div>

            <!-- Check-in/Check-out Section -->
            <div class="section">
                <div class="date-info">
                    <div class="date-item">
                        <div class="date-label">Check-in</div>
                        <div class="date-value" th:if="${booking != null}" th:text="${booking.ngayBatDau}">01/01/2023
                        </div>
                        <div class="date-value" th:unless="${booking != null}">01/01/2023</div>
                    </div>
                    <div class="date-item">
                        <div class="date-label">Check-out</div>
                        <div class="date-value" th:if="${booking != null}" th:text="${booking.ngayKetThuc}">03/01/2023
                        </div>
                        <div class="date-value" th:unless="${booking != null}">03/01/2023</div>
                    </div>
                </div>
            </div>

            <!-- Room Information Section -->
            <div class="section">
                <h3 class="section-title">Thông tin phòng</h3>
                <div class="room-info">
                    <div class="room-detail">
                        <div class="room-name" th:if="${booking != null && booking.tenLoaiPhong != null}"
                            th:text="${booking.tenLoaiPhong}">Phòng Deluxe</div>
                        <div class="room-name" th:unless="${booking != null && booking.tenLoaiPhong != null}">Phòng
                            Deluxe</div>

                        <div class="room-specs">
                            <div class="room-spec">
                                <i class="bi bi-rulers"></i>
                                <span th:if="${booking != null && booking.dienTich != null}"
                                    th:text="${booking.dienTich + ' m²'}">30 m²</span>
                                <span th:unless="${booking != null && booking.dienTich != null}">30 m²</span>
                            </div>
                            <div class="room-spec">
                                <i class="bi bi-people-fill"></i>
                                <span th:if="${booking != null && booking.soNguoi != null}"
                                    th:text="${booking.soNguoi + ' người'}">2 người</span>
                                <span th:unless="${booking != null && booking.soNguoi != null}">2 người</span>
                            </div>
                            <div class="room-spec">
                                <i class="bi bi-door-open-fill"></i>
                                <span th:if="${booking != null && booking.soLuongPhong != null}"
                                    th:text="${booking.soLuongPhong + ' phòng'}">1 phòng</span>
                                <span th:unless="${booking != null && booking.soLuongPhong != null}">1 phòng</span>
                            </div>
                            <div class="room-spec">
                                <i class="bi bi-lamp"></i>
                                <span th:if="${booking != null && booking.soGiuong != null}"
                                    th:text="${booking.soGiuong + ' giường'}">1 giường</span>
                                <span th:unless="${booking != null && booking.soGiuong != null}">1 giường</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Default Services Section -->
            <div class="section">
                <h3 class="section-title">Dịch vụ mặc định</h3>
                <div class="service-list">
                    <div th:if="${booking != null && booking.dichVuMacDinhs != null && !booking.dichVuMacDinhs.empty}">
                        <div class="service-item" th:each="dichVu : ${booking.dichVuMacDinhs}">
                            <i class="bi bi-check-circle-fill"></i>
                            <span th:text="${dichVu.servicesOfResort.dichVu.tenDichVu}">Wifi miễn phí</span>
                        </div>
                    </div>
                    <div
                        th:unless="${booking != null && booking.dichVuMacDinhs != null && !booking.dichVuMacDinhs.empty}">
                        <div class="service-item">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Wifi miễn phí</span>
                        </div>
                        <div class="service-item">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Bữa sáng miễn phí</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Requested Services Section -->
            <div class="section">
                <h3 class="section-title">Dịch vụ yêu cầu</h3>
                <div class="service-list">
                    <div th:if="${booking != null && booking.dichVuYeuCaus != null && !booking.dichVuYeuCaus.empty}">
                        <div class="service-item" th:each="dichVu : ${booking.dichVuYeuCaus}">
                            <i class="bi bi-check-circle-fill"></i>
                            <span th:text="${dichVu.servicesOfResort.dichVu.tenDichVu}">Đưa đón sân bay</span>
                        </div>
                    </div>
                    <div
                        th:unless="${booking != null && booking.dichVuYeuCaus != null && !booking.dichVuYeuCaus.empty}">
                        <div class="service-item">
                            <i class="bi bi-check-circle-fill"></i>
                            <span>Không có dịch vụ yêu cầu</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cancellation Policy Section -->
            <div class="section">
                <h3 class="section-title">Chính sách hủy phòng</h3>
                <div class="cancellation-policy">
                    <div class="policy-header">Cancellation policy</div>
                    <div class="policy-alert">
                        <div class="policy-alert-title">Now, cancellation is non-refundable</div>
                        <div class="policy-alert-text">From 05 Feb 5:32 PM (Ho Chi Minh City time)</div>
                    </div>
                    <div class="policy-detail">
                        Failure to arrive at your hotel or property will be treated as a No-Show and will incur a charge
                        of 100% of the booking value (Hotel policy).
                    </div>
                </div>
            </div>

            <!-- Price Summary Section -->
            <div class="section">
                <h3 class="section-title">Tổng giá tiền</h3>
                <div class="price-summary">
                    <div class="price-row">
                        <div class="price-label">Giá phòng</div>
                        <div class="price-value" th:if="${booking != null && booking.tongGiaTien != null}"
                            th:text="${#numbers.formatDecimal(booking.tongGiaTien, 0, 'COMMA', 0, 'POINT') + ' VND'}">
                            2,000,000 VND</div>
                        <div class="price-value" th:unless="${booking != null && booking.tongGiaTien != null}">2,000,000
                            VND</div>
                    </div>
                    <div class="price-row">
                        <div class="price-label">Thuế và phí</div>
                        <div class="price-value">Đã bao gồm</div>
                    </div>
                    <div class="price-row total-price">
                        <div class="price-label">Tổng cộng</div>
                        <div class="price-value" th:if="${booking != null && booking.tongGiaTien != null}"
                            th:text="${#numbers.formatDecimal(booking.tongGiaTien, 0, 'COMMA', 0, 'POINT') + ' VND'}">
                            2,000,000 VND</div>
                        <div class="price-value" th:unless="${booking != null && booking.tongGiaTien != null}">2,000,000
                            VND</div>
                    </div>
                </div>

                <button th:if="${booking != null && booking.tinhTrang == 'upcoming'}" class="cancel-button"
                    id="cancelBookingBtn">Hủy đặt phòng</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cancelBtn = document.getElementById('cancelBookingBtn');

            if (cancelBtn) {
                cancelBtn.addEventListener('click', function () {
                    if (confirm('Bạn có chắc chắn muốn hủy đặt phòng này không? Việc hủy có thể sẽ không được hoàn tiền.')) {
                        // Lấy ID đặt phòng từ URL
                        const urlParams = new URLSearchParams(window.location.search);
                        const bookingId = urlParams.get('id');

                        if (bookingId) {
                            // Gọi API hủy phòng
                            fetch(`/api/booking/${bookingId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            })
                                .then(response => {
                                    if (response.ok) {
                                        alert('Đã hủy đặt phòng thành công!');
                                        window.location.href = '/user/booking-history';
                                    } else {
                                        return response.json().then(data => {
                                            throw new Error(data || 'Có lỗi xảy ra khi hủy đặt phòng');
                                        });
                                    }
                                })
                                .catch(error => {
                                    alert('Lỗi: ' + error.message);
                                });
                        }
                    }
                });
            }
        });
    </script>
</body>

</html>