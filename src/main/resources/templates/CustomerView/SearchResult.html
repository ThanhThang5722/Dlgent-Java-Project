<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết quả tìm kiếm khu nghỉ dưỡng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/CustomerView/SearchResult.css}">
    <link rel="stylesheet" href="/src/main/resources/static/css/CustomerView/SearchResult.css">
    <link rel="stylesheet" href="https://unpkg.com/@coreui/coreui/dist/css/coreui.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    <script src="https://unpkg.com/@coreui/coreui/dist/js/coreui.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <style>
        /* Custom styles cho daterangepicker */
        .daterangepicker td.in-range {
            background-color: #9cc4ee;
            /* Màu nền nhạt cho khoảng từ ngày bắt đầu đến ngày kết thúc */
        }

        .daterangepicker td.active,
        .daterangepicker td.active:hover {
            background-color: #0071c2;
            /* Màu đậm cho ngày được chọn */
            color: #ffffff;
        }

        /* Style cho ngày trước ngày hiện tại hoặc ngày đã chọn */
        .daterangepicker td.disabled {
            color: #ccc !important;
            text-decoration: line-through;
            background-color: #f8f8f8;
            cursor: not-allowed;
        }

        /* Style cho ngày đã được chọn */
        .daterangepicker td.start-date {
            border-radius: 4px 0 0 4px;
        }

        .daterangepicker td.end-date {
            border-radius: 0 4px 4px 0;
        }

        .search-btn {
            background-color: #2a65db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 25px;
            font-weight: bold;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }
    </style>
</head>

<body>
    <!-- Search Bar -->
    <div class="search-bar mb-3">
        <div class="container">
            <form th:action="@{/tim-kiem-resort/ket-qua}" method="get" class="row g-2 align-items-center">
                <div class="col-md-3">
                    <input type="text" class="form-control search-input" id="searchTerm" name="searchTerm"
                        th:value="${searchTerm}" placeholder="Điểm đến của bạn?">
                </div>
                <div class="col-md-4">
                    <div class="position-relative" style="z-index: 1;">
                        <input type="text" class="form-control date-range-picker" id="dateRange" name="dateRange"
                            th:value="${checkIn != null ? #temporals.format(checkIn, 'dd/MM/yyyy') + ' - ' + #temporals.format(checkOut, 'dd/MM/yyyy') : ''}"
                            placeholder="Chọn ngày đến - ngày đi">
                        <!-- Hidden inputs for compatibility -->
                        <input type="hidden" id="checkIn" name="checkIn"
                            th:value="${checkIn != null ? #temporals.format(checkIn, 'yyyy-MM-dd') : ''}">
                        <input type="hidden" id="checkOut" name="checkOut"
                            th:value="${checkOut != null ? #temporals.format(checkOut, 'yyyy-MM-dd') : ''}">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select search-input" id="soNguoi" name="soNguoi">
                        <option value="1" th:selected="${soNguoi == 1}">1 người</option>
                        <option value="2" th:selected="${soNguoi == 2}">2 người</option>
                        <option value="3" th:selected="${soNguoi == 3}">3 người</option>
                        <option value="4" th:selected="${soNguoi == 4}">4 người</option>
                        <option value="5" th:selected="${soNguoi == 5}">5 người</option>
                        <option value="6" th:selected="${soNguoi == 6}">6 người</option>
                        <option value="8" th:selected="${soNguoi == 8}">8 người</option>
                        <option value="10" th:selected="${soNguoi == 10}">10 người</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn search-btn w-100">TÌM KIẾM</button>
                </div>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <!-- Filter Column -->
            <div class="col-md-3">
                <!-- Map Search -->
                <div class="map-search position-relative mb-3">
                    <img src="https://maps.googleapis.com/maps/api/staticmap?center=VungTau,Vietnam&zoom=13&size=400x150&maptype=roadmap&key=YOUR_API_KEY"
                        class="map-img" alt="Map">
                    <div class="map-overlay">
                        <i class="bi bi-geo-alt-fill map-icon d-block"></i>
                        TÌM TRÊN BẢN ĐỒ
                    </div>
                </div>

                <!-- Text Search -->
                <div class="mb-3">
                    <input type="text" class="search-text" placeholder="Tìm kiếm">
                </div>

                <!-- Budget Slider -->
                <div class="filter-card">
                    <div class="filter-title">Ngân sách của bạn (mỗi đêm)</div>
                    <div class="budget-slider">
                        <input type="range" class="form-range" min="0" max="5000000" step="100000" id="priceRange">
                        <div class="price-range">
                            <span>0₫</span>
                            <span>5,000,000₫</span>
                        </div>
                    </div>
                </div>

                <!-- Popular Filters -->
                <div class="filter-card">
                    <div class="filter-title">Bộ lọc phổ biến cho Vũng Tàu</div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="freeCancel">
                            <label class="form-check-label" for="freeCancel">
                                Hủy miễn phí
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="breakfast">
                            <label class="form-check-label" for="breakfast">
                                Bữa sáng miễn phí
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="wifi">
                            <label class="form-check-label" for="wifi">
                                WiFi miễn phí
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="pool">
                            <label class="form-check-label" for="pool">
                                Hồ bơi
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="aircon">
                            <label class="form-check-label" for="aircon">
                                Máy lạnh
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="balcony">
                            <label class="form-check-label" for="balcony">
                                Ban công/sân hiên
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Star Rating -->
                <div class="filter-card">
                    <div class="filter-title">Xếp hạng sao</div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="star5">
                            <label class="form-check-label" for="star5">
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="star4">
                            <label class="form-check-label" for="star4">
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                            </label>
                        </div>
                    </div>
                    <div class="filter-item">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="star3">
                            <label class="form-check-label" for="star3">
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Column -->
            <div class="col-md-9">
                <!-- Sort options -->
                <div class="d-flex mb-3 flex-wrap">
                    <div class="me-2 mb-2" style="font-size: 13px;">Sắp xếp theo:</div>
                    <button class="sort-btn active mb-2">Phù hợp nhất</button>
                    <button class="sort-btn mb-2">Đánh giá cao nhất</button>
                    <button class="sort-btn mb-2">Giá thấp nhất</button>
                    <button class="sort-btn mb-2">Khoảng cách</button>
                    <button class="sort-btn mb-2">Ưu đãi hot</button>
                </div>

                <!-- Welcome Message -->
                <div class="alert alert-primary mb-3" style="font-size: 13px;">
                    Chào mừng bạn! Hãy nhập ngày ở vào ô tìm kiếm để tiếp tục đặt phòng tại khu nghỉ dưỡng.
                </div>

                <!-- Results alert if empty -->
                <div th:if="${ketQuaTimKiem.empty}" class="alert alert-info">
                    Không tìm thấy kết quả phù hợp. Vui lòng thử lại với từ khóa khác.
                </div>

                <!-- Results list -->
                <div th:each="resort : ${ketQuaTimKiem}" class="resort-card">
                    <div class="row g-0">
                        <!-- Resort Image -->
                        <div class="col-md-3 position-relative">
                            <div class="heart-icon">
                                <i class="bi bi-heart"></i>
                            </div>
                            <img th:if="${resort.imageUrl != null}" th:src="${resort.imageUrl}" class="resort-img"
                                alt="Resort Image">
                            <img th:if="${resort.imageUrl == null}"
                                src="https://cf.bstatic.com/xdata/images/hotel/square600/261707778.webp?k=fa6b6128468ec15e81f7d076b6f2473fa3a80c255582f155cae35f9edbffdd78"
                                class="resort-img" alt="Resort Image">
                        </div>

                        <!-- Resort Info -->
                        <div class="col-md-7 p-3 d-flex flex-column justify-content-between">
                            <div class="d-flex flex-column justify-content-between">
                                <h5 th:text="${resort.tenResort}" class="property-name mb-1">Tên resort</h5>
                                <div class="">
                                    <i class="bi bi-geo-alt-fill"></i>
                                    <span th:text="${resort.diaChi}" class="ms-1 address-text">Địa chỉ</span>
                                </div>
                                <!-- Services -->
                                <div class="my-2">
                                    <span class="service-badge">Bữa sáng</span>
                                    <span class="service-badge">Fitness miễn phí</span>
                                    <span class="service-badge">+4</span>
                                </div>
                            </div>

                            <div>
                                <p class="mb-2 free-service"><i class="bi bi-check-circle-fill"></i> FREE cancellation
                                </p>

                                <a th:href="@{'/resort-detail/' + ${resort.tenResort}}"
                                    class="btn btn-outline-primary btn-sm w-25">Xem
                                    chi tiết</a>
                            </div>
                        </div>

                        <!-- Price & Rating -->
                        <div class="col-md-2 p-3 text-end d-flex flex-column justify-content-between">
                            <!-- Rating -->
                            <div class="mb-3 d-flex flex-column align-items-end">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="rating-text me-2" th:if="${resort.rate != null}"
                                        th:text="${resort.rate}">8.9</span>
                                    <span class="rating-text me-2" th:if="${resort.rate == null}">0</span>
                                    <span class="rating-badge">Tuyệt vời</span>
                                </div>
                                <span class="reviews-count">2,356 đánh giá</span>
                            </div>

                            <!-- Price -->
                            <div>
                                <div class="mb-1 original-price">đ5,893,162</div>
                                <div class="d-flex align-items-center justify-content-end">
                                    <div class="current-price"
                                        th:text="${#numbers.formatDecimal(resort.giaThapNhat, 0, 'COMMA', 0, 'POINT')} + '₫'">
                                        2,015,207₫</div>
                                    <span class="discount-badge">-66%</span>
                                </div>
                                <div class="price-details">Per night before taxes and fees</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@coreui/coreui/dist/js/coreui.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const calendar = document.querySelector('[data-coreui-toggle="calendar"]');
            const checkInInput = document.getElementById('checkIn');
            const checkOutInput = document.getElementById('checkOut');

            calendar.addEventListener('change', function (e) {
                const dates = e.detail;
                if (dates.startDate && dates.endDate) {
                    checkInInput.value = dates.startDate.toISOString().split('T')[0];
                    checkOutInput.value = dates.endDate.toISOString().split('T')[0];
                }
            });
        });

        $('#dateRange').daterangepicker({
            autoUpdateInput: false,
            minDate: moment(), // Chỉ cho phép chọn từ ngày hiện tại trở đi
            showDropdowns: true, // Hiển thị dropdown chọn tháng/năm
            linkedCalendars: false, // Hiển thị 2 lịch độc lập nhau
            drops: 'down', // Buộc hiển thị xuống dưới
            opens: 'center', // Căn giữa
            isInvalidDate: function (date) {
                // Vô hiệu hóa những ngày trước ngày hiện tại
                return date.isBefore(moment(), 'day');
            },
            locale: {
                format: 'DD/MM/YYYY',
                applyLabel: 'Áp dụng',
                cancelLabel: 'Hủy',
                fromLabel: 'Từ',
                toLabel: 'Đến',
                customRangeLabel: 'Tùy chọn',
                daysOfWeek: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
                monthNames: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
                firstDay: 1
            }
        });

        // Cập nhật giá trị input khi chọn xong ngày
        $('#dateRange').on('apply.daterangepicker', function (ev, picker) {
            $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));

            // Cập nhật giá trị cho hidden inputs
            $('#checkIn').val(picker.startDate.format('YYYY-MM-DD'));
            $('#checkOut').val(picker.endDate.format('YYYY-MM-DD'));
        });

        // Xóa giá trị input khi cancel
        $('#dateRange').on('cancel.daterangepicker', function (ev, picker) {
            $(this).val('');
        });

        // Xử lý sự kiện khi chọn ngày bắt đầu, cập nhật lại minDate cho ngày kết thúc
        $('#dateRange').on('show.daterangepicker', function (ev, picker) {
            picker.container.on('mousedown.daterangepicker', '.calendar-table', function () {
                setTimeout(function () {
                    if (picker.startDate && !picker.endDate) {
                        // Nếu đã chọn ngày bắt đầu nhưng chưa chọn ngày kết thúc
                        // Vô hiệu hóa tất cả các ngày trước ngày bắt đầu
                        $('.daterangepicker td.available').each(function () {
                            var date = moment($(this).attr('data-date'), 'YYYY-MM-DD');
                            if (date.isBefore(picker.startDate, 'day')) {
                                $(this).addClass('disabled');
                            }
                        });
                    }
                }, 0);
            });
        });

        // Đảm bảo nút tìm kiếm luôn hiển thị
        $(document).ready(function () {
            $('.search-btn').css({
                'position': 'relative',
                'z-index': '2'
            });
        });
    </script>
</body>

</html>